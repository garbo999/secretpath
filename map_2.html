<!DOCTYPE html>
<html>
<head>
  <style>
    #googleMap {
      width:100vw;
      height:100vh;}

    .gm-style img {
      -webkit-filter: grayscale(100%);
      -moz-filter: grayscale(100%);
      -ms-filter: grayscale(100%);
      -o-filter: grayscale(100%);
      filter: grayscale(100%);
      filter: url(grayscale.svg); /* Firefox 4+ */
      filter: gray; /* IE 6-9 */}
  </style>

<script
src="http://maps.googleapis.com/maps/api/js">
</script>

<script>
var my_lat, my_long;
//var dest_lat_1, dest_long_1;

// insert new destination information here
// position_array[0][0] --> position 1 latitude
// position_array[0][1] --> position 1 longitude
// etc.
var position_array = [
    [58.38432, 24.49296, 'vallikaar', 'picture link'], // destination 1
    [58.37641, 24.47798, 'spit', 'picture link'], // destination 1
    [58.38053, 24.49229, 'amanda villa', 'picture link'], // destination 1
    [58.37859, 24.50497, 'villa ene', 'picture link'], // destination 1
    [58.38267, 24.48776, 'spa tervis', 'picture link'], // destination 1
];


if (typeof(Number.prototype.toRad) === "undefined") {
  Number.prototype.toRad = function() {
    return this * Math.PI / 180;
  }
}

if (typeof(Number.prototype.toDeg) === "undefined") {
  Number.prototype.toDeg = function() {
    return this * 180 / Math.PI;
  }
}

/**
 * Returns a random integer between min (inclusive) and max (inclusive)
 * Using Math.round() will give you a non-uniform distribution!
 */
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  var R = 6371; // Radius of the earth in km
  var dLat = deg2rad(lat2-lat1);  // deg2rad below
  var dLon = deg2rad(lon2-lon1); 
  var a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
    Math.sin(dLon/2) * Math.sin(dLon/2)
    ; 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI/180)
}




/*var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)
var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0)
*/
/*console.log(w + "," + h);
*/
var options = {
  enableHighAccuracy: false,
  timeout: 1000,
  maximumAge: 0
};

function getLocation() {
  if (navigator.geolocation) {
      navigator.geolocation.watchPosition(initialize, errorCallback, options);
  } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function errorCallback(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
    }
}

function initialize(position) {
  var x = document.getElementById("demo");

  x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;  

  my_lat = position.coords.latitude;
  my_long = position.coords.longitude;


  var s;
  var distance_array = new Array();
  var min_index;
  for (i = 0; i < position_array.length; i++) {
      distance_array.push(getDistanceFromLatLonInKm(my_lat,my_long,position_array[i][0],position_array[i][1]));
  }

  var min_index = distance_array.indexOf(Math.min.apply(Math, distance_array));
  var random_index = getRandomInt(0, distance_array.length-1);

  console.log(distance_array);
  console.log('min_index=', min_index);
  console.log('random_index=', random_index);



  var myCenter=new google.maps.LatLng(my_lat, my_long);
  var myPos2=new google.maps.LatLng(position_array[random_index][0], position_array[random_index][1]); // for testing
  //var myPos2=new google.maps.LatLng(position_array[min_index][0], position_array[min_index][1]);

  // ddkdkdkd

  var mapProp = {
    center:myCenter,
    zoom:15,
    mapTypeId:google.maps.MapTypeId.ROADMAP,
    zoomControl: false
  };

  var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);
  map.setOptions({draggable: false, zoomControl: false, scrollwheel: false, disableDoubleClickZoom: true});
  // need to combine setOptions with mapProp

/*  var marker=new google.maps.Marker({
    position:myCenter,
    icon:'pinkball.png'
    //icon:'safe_image.png'
  });
*/  var marker1=new google.maps.Marker({
    position:myPos2,
  });

  //marker.setMap(map);
  marker1.setMap(map);

  var bounds = new google.maps.LatLngBounds();
  bounds.extend(myCenter);
  bounds.extend(myPos2);
  map.fitBounds(bounds);


  lat1 = my_lat;
  //lat2 = position_array[min_index][0];
  lat2 = position_array[random_index][0];
  lon1 = my_long;
  //lon2 = position_array[min_index][1];
  lon2 = position_array[random_index][1];

  var dLat = (lat2-lat1).toRad();
  var dLon = (lon2-lon1).toRad();
  var lat1 = lat1.toRad();
  var lat2 = lat2.toRad();

  var y = Math.sin(dLon) * Math.cos(lat2);
  var x = Math.cos(lat1)*Math.sin(lat2) -
          Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
  var brng = Math.atan2(y, x).toDeg();

  console.log('brng=' +brng);

  placeMarker(map.getCenter(), brng);

  //function
  function placeMarker(location, rotation) {
    var marker = new google.maps.Marker({
      position: location,
      icon: {
        path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
        scale: 7,
        //fillColor:
        //fillOpacity:
        //https://developers.google.com/maps/documentation/javascript/symbols
        rotation: rotation
      },
      draggable: false,
      map: map
    });
  }

}

google.maps.event.addDomListener(window, 'load', getLocation);
</script>
</head>

<body>
  <p id="demo"></p>
  <div id="googleMap"></div>
</body>
</html>
